<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRAGA</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --red:#ff1744;--blue:#00e5ff;--gold:#ffd700;--green:#00e676;--dark:#050505;
  --glass:rgba(10,10,10,.95);--border:rgba(255,255,255,.12);
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Rajdhani;background:#000;color:#fff;overflow:hidden}

.screen{position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column}
.screen.active{display:flex}

.glass{background:var(--glass);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:12px}

.btn-main{
  background:#fff;color:#800;border:none;padding:15px 30px;
  font-size:1.2rem;font-weight:800;border-radius:8px;
  cursor:pointer;margin:8px;width:260px;
}
.btn-main:hover{background:var(--red);color:#fff}

#startMenu{background:radial-gradient(circle,#ff1744 0%,#600000 50%,#000 100%)}
#selectionFlow{background:#000;overflow-y:auto;padding:40px 0}

.setup-card{width:90%;max-width:800px;padding:40px;text-align:center;display:none}
.setup-card.active{display:block}

.grid-select{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:15px;margin:25px 0}
.opt-box{padding:20px;border:1px solid #333;border-radius:8px;cursor:pointer}
.opt-box.selected{border-color:var(--red);background:rgba(255,23,68,.15)}

#mainGame{display:none}
#map{width:100%;height:100vh}

.top-hud,.bottom-hud{
  position:fixed;left:2%;width:96%;z-index:1000;
  display:flex;align-items:center;padding:10px 20px
}
.top-hud{top:10px;height:50px}
.bottom-hud{bottom:10px;height:140px;justify-content:space-between}

.bar-bg{height:10px;background:#111;border-radius:5px;overflow:hidden}
.bar-fill{height:100%;width:0;transition:.3s}

#ticker{flex:1;color:#ccc;font-size:.85rem;white-space:nowrap;overflow:hidden}
#ticker span{display:inline-block;animation:ticker 20s linear infinite}
@keyframes ticker{from{transform:translateX(100%)}to{transform:translateX(-100%)}}

.popup{
  position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
  width:380px;padding:30px;z-index:5000;display:none
}
</style>
</head>

<body>

<!-- MENU -->
<div id="startMenu" class="screen active">
  <div style="font-family:Orbitron;font-size:4.5rem;letter-spacing:12px">PRAGA</div>
  <button class="btn-main" onclick="initSetup()">Iniciar</button>
</div>

<!-- SETUP -->
<div id="selectionFlow" class="screen">
  <div id="setupType" class="glass setup-card active">
    <h2 style="color:var(--red);font-family:Orbitron">AGENTE</h2>
    <div class="grid-select">
      <div class="opt-box" onclick="setVar('pathogen','Bactéria',this)">Bactéria</div>
      <div class="opt-box" onclick="setVar('pathogen','Vírus',this)">Vírus</div>
    </div>
    <button class="btn-main" onclick="nextStep('setupName')">Próximo</button>
  </div>

  <div id="setupName" class="glass setup-card">
    <h2 style="color:var(--blue);font-family:Orbitron">NOME</h2>
    <input id="nameIn" placeholder="PRAGA-X"
      style="width:100%;padding:20px;font-size:2rem;text-align:center">
    <button class="btn-main" onclick="startGame()">Iniciar Simulação</button>
  </div>
</div>

<!-- GAME -->
<div id="mainGame">
  <div id="map"></div>

  <div class="glass top-hud">
    <div id="ticker"><span id="news">SISTEMA BIOTÁTICO ONLINE.</span></div>
    <button class="btn-main" style="width:60px" onclick="setSpeed(1)">x1</button>
    <button class="btn-main" style="width:60px" onclick="setSpeed(3)">x3</button>
  </div>

  <div class="glass bottom-hud">
    <div style="flex:1">
      <div>Infectados</div>
      <div class="bar-bg"><div id="bInf" class="bar-fill" style="background:var(--red)"></div></div>
    </div>
    <div style="margin-left:30px;text-align:right">
      <div style="color:var(--gold);font-size:2.5rem" id="mut">10</div>
      <small>Mutagenicidade</small>
    </div>
  </div>
</div>

<!-- POPUP PAÍS -->
<div id="countryPopup" class="glass popup">
  <h2 id="popCountry" style="color:var(--blue);font-family:Orbitron"></h2>
  <p id="popData" style="margin:15px 0;color:#ccc"></p>
  <button class="btn-main" onclick="confirmOutbreak()">Iniciar surto</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* ======= ESTADO ======= */
const WORLD_POP = 8000000000;
let loopId=null;

const game={
  active:false,started:false,speed:1,
  name:'',pathogen:'',
  mut:10,tally:10,
  infected:0,healthy:WORLD_POP,
  selectedCountry:null
};

/* ======= SPA ======= */
function initSetup(){
  startMenu.classList.remove('active');
  selectionFlow.classList.add('active');
}
function setVar(k,v,el){
  game[k]=v;
  el.parentElement.querySelectorAll('.opt-box').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');
}
function nextStep(id){
  document.querySelectorAll('.setup-card').forEach(c=>c.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* ======= MAPA ======= */
let map,countryLayer;

const countriesGeoJSON={
"type":"FeatureCollection",
"features":[
{"type":"Feature","properties":{"name":"Brasil","pop":214000000},"geometry":{"type":"Polygon","coordinates":[[[-74,-34],[-34,-34],[-34,6],[-74,6],[-74,-34]]]}},
{"type":"Feature","properties":{"name":"EUA","pop":331000000},"geometry":{"type":"Polygon","coordinates":[[[-125,25],[-66,25],[-66,49],[-125,49],[-125,25]]]}},
{"type":"Feature","properties":{"name":"China","pop":1440000000},"geometry":{"type":"Polygon","coordinates":[[[73,18],[135,18],[135,53],[73,53],[73,18]]]}}
]};

function startGame(){
  game.name=nameIn.value||'PRAGA-X';
  selectionFlow.classList.remove('active');
  mainGame.style.display='block';
  initMap();
}

function initMap(){
  map=L.map('map',{center:[15,0],zoom:2.3,zoomControl:false});
  countryLayer=L.geoJSON(countriesGeoJSON,{
    style:()=>({color:'#555',weight:1,fillColor:'#111',fillOpacity:.6}),
    onEachFeature:(f,l)=>{
      l.on('click',()=>{
        if(game.started) return;
        game.selectedCountry=f;
        popCountry.innerText=f.properties.name.toUpperCase();
        popData.innerHTML=`População: ${f.properties.pop.toLocaleString()}`;
        countryPopup.style.display='block';
        l.setStyle({fillColor:var(--red)});
      });
    }
  }).addTo(map);
}

function confirmOutbreak(){
  game.started=true;
  game.active=true;
  game.infected=1;
  game.healthy--;
  news.innerText=`CASO ZERO CONFIRMADO EM ${game.selectedCountry.properties.name.toUpperCase()}`;
  countryPopup.style.display='none';
  startLoop();
}

/* ======= SIMULAÇÃO ======= */
function setSpeed(s){game.speed=s}

function startLoop(){
  if(loopId) return;
  loopId=setInterval(()=>{
    if(!game.active) return;
    for(let i=0;i<game.speed;i++){
      let spread=Math.min(game.infected*0.05,game.healthy);
      game.infected+=spread;
      game.healthy-=spread;

      let calc=Math.floor(game.infected/1000)+10;
      if(calc>game.tally){
        game.mut+=calc-game.tally;
        game.tally=calc;
      }
    }
    updateUI();
  },500);
}

function updateUI(){
  bInf.style.width=(game.infected/WORLD_POP*100)+'%';
  mut.innerText=Math.floor(game.mut);
}
</script>
</body>
</html>
